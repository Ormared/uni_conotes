ПРИКЛАДНИЙ РІВЕНЬ
DNS - Служба Доменних Імен

# Служба Доменних Імен

- ІР-адреси - тяжко запам'ятовувати, динамічно змінюються → мнемонічні символьні імена → 
потрібен механізм перетворення імен на ІРадреси
- ARPANET - файл hosts
- 1983 - DNS, описаний в RFC 1034, 1035 i 2181
- DNS - ієрархічна схема імен, заснована на доменах, + розподілена БД, що реалізує цю схему імен

# Простір Імен Dns

- В Інтернет ієрархія розроблена **ICANN** (Internet Corporation for Assigned Names and Numbers)
- Домени верхнього рівня: **родові** (generic) і національні (countries)
- В 2010 - можливість використовувати не латинський алфавіт
- Довжина імен компонентів - 63 символи, довжина повного імені - до 255 символів

# Простір Імен Dns

![4_image_0.png](4_image_0.png)

# Родові Домени Верхнього Рівня

| Домен   | Використання             | Дата заснування   | Обмежений?   |
|---------|--------------------------|-------------------|--------------|
| com     | Комерційні цілі          | 1985              | Ні           |
| edu     | Освітні заклади          | 1985              | Так          |
| gov     | Уряд                     | 1985              | Так          |
| int     | Міжнародні організації   | 1988              | Так          |
| mil     | Військові                | 1985              | Так          |
| net     | Оператори мережі         | 1985              | Ні           |
| org     | Некомерційні організації | 1985              | Ні           |
| aero    | Авіатранспорт            | 2001              | Так          |
| biz     | Бізнес                   | 2001              | Ні           |
| coop    | Кооперативи              | 2001              | Так          |
| info    | Інформація               | 2002              | Ні           |
| museum  | Музеї                    | 2002              | Так          |
| name    | Люди                     | 2002              | Ні           |
| pro     | Професіонали             | 2002              | Так          |
| jobs    | Зайнятість               | 2005              | Так          |
| mobi    | Мобільні пристрої        | 2005              | Так          |
| tel     | Контактна інформація     | 2005              | Так          |
| travel  | Туризм і подорожі        | 2005              | Так          |

# Записи Ресурсів Доменів

- Кожен домен має набір асоційованих з ним записів ресурсів (resource records). Ці записи є базою даних DNS.

- Призначення системи DNS - перетворення доменних імен в записи ресурсів
- Запис ресурсу складається з наступних частин:
Domain_name Time_to_live Class Type Value

# Основні Типи Записів Ресурсів Dns

| Тип                  | Зміст                                 | Значення                                                      |
|----------------------|---------------------------------------|---------------------------------------------------------------|
| SOA                  | Початковий запис зони                 | Параметри для цієї зони                                       |
| A                    | IPv4-адреса вузла                     | Ціле число, 32 біти                                           |
| AAAA                 | IPv6-адреса вузла                     | Ціле число, 128 бітів                                         |
| MX                   | Обмін пошти                           | Ім'я і пріоритет поштового сервера домена                     |
| NS                   | Сервер імен                           | Ім'я DNS сервера для цього домена                             |
| CNAME                | Канонічне ім'я                        | Ім'я, що відповідає даному псевдоніму                         |
| PTR                  | Вказівник                             | Псевдонім ІР-адреси Текстове поле: перелік серверів, що мають |
| Правила відправлення |                                       |                                                               |
| SPF                  | право відправляти пошту зі зворотними |                                                               |
| пошти                | адресами в цьому домені               |                                                               |
| SRV                  | Сервіс                                | Ім'я вузла, що надає даний сервіс                             |
| TXT                  | Текст                                 | Не інтерпретований ASCII текст                                |

# Поділ Простору Імен Dns На Зони

![8_image_0.png](8_image_0.png)

![9_image_0.png](9_image_0.png)

| ; Authoritative data for cs.vu.nl   | SOA            | star boss (9527,7200,7200,241920,86400)   |                 |                |
|-------------------------------------|----------------|-------------------------------------------|-----------------|----------------|
| cs.vu.nl.                           | 86400          | ІИ                                        |                 |                |
| cs.vu.nl.                           | 86400          | ІИ                                        | МХ              | 1 zephyr       |
| cs.vu.nl.                           | 86400          | ІИ                                        | МХ              | 2 top          |
| cs.vu.nl.                           | 86400          | ІИ                                        | NS              | star           |
| star                                | 86400          | І                                         | А               | 130.37.56.205  |
| 86400                               | А              | 130.37.20.10                              |                 |                |
| zephyr                              | ІИ             |                                           |                 |                |
| 86400                               | 130.37.20.11   |                                           |                 |                |
| top                                 | ІИ             | А                                         |                 |                |
| С СПАМЕ                             |                |                                           |                 |                |
| WW                                  | 86400          | ІИ                                        | star.cs.vu.nl   |                |
| С СЛАМЕ                             |                |                                           |                 |                |
| ftp                                 | 86400          | ІИ                                        | zephyr.cs.vu.nl |                |
| flits                               | 86400          | ІИ                                        | А               | 130.37.16.112  |
| flits                               | 86400          | ІИ                                        | А               | 192.31.231.165 |
| flits                               | 86400          | ІИ                                        | МХ              | 1 flits        |
| flits                               | 86400          | ІИ                                        | МХ              | 2 zephyr       |
| flits                               | 86400          | 3 top                                     |                 |                |
| IN                                  | МХ             |                                           |                 |                |
| rowboat                             | І              | А                                         | 130.37.56.201   |                |
| І                                   | МХ             | 1 rowboat                                 |                 |                |
| І                                   | МХ             | 2 zephyr                                  |                 |                |
| little-sister                       | I А            | 130.37.62.23                              |                 |                |
| IN A                                | 192.31.231.216 |                                           |                 |                |
| laserjet                            |                |                                           |                 |                |

# Обернена Зона

![10_image_0.png](10_image_0.png)

# Типи Серверів Імен

- Авторитетний **DNS-сервер** - сервер, що відповідає за свою зону:
- первинний
- вторинні
- **Кеш-сервер DNS** - сервер, який обслуговує запити клієнтів
- **DNS-сервер пересилання** (forwarder)
- **Кореневий DNS-сервер**
- **Реєстраційний DNS-сервер** - **DNSBL-сервер** (сервер з чорними списками)

# 13 Кореневих Серверів Dns

Designation, Responsibility, and Locations

![12_image_0.png](12_image_0.png)

![12_image_1.png](12_image_1.png)

M-WIDE Keio B-DISA-USC Marina delRey CA
L-DISA-USC Marina delRey CA
H-USArmy Aberdeen MD
J-NSF-NSI Herndon VA

# Кореневі Сервери Dns

| Ім'я сервера       | ІР-адреси                         | Управляється                            |
|--------------------|-----------------------------------|-----------------------------------------|
| a.root-servers.net | 198.41.0.4, 2001:503:ba3e::2:30   | VeriSign, Inc.                          |
| b.root-servers.net | 192.228.79.201, 2001:500:84::b    | University of Southern California (ISI) |
| c.root-servers.net | 192.33.4.12, 2001:500:2::c        | Cogent Communications                   |
| d.root-servers.net | 199.7.91.13, 2001:500:2d::d       | University of Maryland                  |
| e.root-servers.net | 192.203.230.10                    | NASA (Ames Research Center)             |
| f.root-servers.net | 192.5.5.241, 2001:500:2f::f       | Internet Systems Consortium, Inc.       |
| g.root-servers.net | 192.112.36.4                      | US Department of Defense (NIC)          |
| h.root-servers.net | 198.97.190.53, 2001:500:1::53     | US Army (Research Lab)                  |
| i.root-servers.net | 192.36.148.17, 2001:7fe::53       | Netnod                                  |
| j.root-servers.net | 192.58.128.30, 2001:503:c27::2:30 | VeriSign, Inc.                          |
| k.root-servers.net | 193.0.14.129, 2001:7fd::1         | RIPE NCC                                |
| l.root-servers.net | 199.7.83.42, 2001:500:9f::42      | ICANN                                   |
| m.root-servers.net | 202.12.27.33, 2001:dc3::35        | WIDE Project                            |

# Кореневі Сервери Dns: Понад 130 Фізичних Локацій

![14_image_0.png](14_image_0.png)

# Перетворення Імен

- **Авторитетний запис** (authoritative record) –
запис, отриманий з джерела, що зберігає цей запис і керує його станом
- Авторитетний запис завжди правильний, на відміну від кешованих **записів** (cached records), які можуть застаріти

# Нерекурсивна Схема Перетворення Імен

- DNS-клієнт звертається до **кореневого** DNSсервера з вказівкою повного доменного імені;
- DNS-сервер відповідає клієнту, вказуючи адресу наступного DNS-сервера, який виконує обслуговування домену верхнього рівня
- DNS-клієнт виконує запит наступного DNSсервера, який його надсилає до DNS-сервера потрібного піддомена і т. д., доки не буде знайдено авторитетний DNS-сервер. Сервер дає кінцеву відповідь.

# Рекурсивна Схема Перетворення Імен

- DNS-клієнт запитує **локальний** DNS-сервер, який обслуговує піддомен, якому належить клієнт
- Якщо локальний DNS-сервер відповідь знає, то повертає її клієнту, в протилежному випадку виконує ітеративні запити до кореневого сервера до тих пір, поки не отримає відповідь

# Приклад Перетворення Імені

![18_image_0.png](18_image_0.png)

# Протокол Dns

Транспортний протокол: UDP, порт сервера 53

![19_image_0.png](19_image_0.png)

# Формат Запису Ресурсу Dns

| 12                   | 16            | 20   | 24   | 28   | 32   |
|----------------------|---------------|------|------|------|------|
| 0                    | 4             | 8    | Name |      |      |
| Туре                 | Class         |      |      |      |      |
| Time To Live (TTL)   |               |      |      |      |      |
| Resource Data Length | Resource Data |      |      |      |      |

Електронна Пошта

# Архітектура 

![22_Image_0.Png](22_Image_0.Png)

системи електронної пошти
- **MUA (Mail User Agent)**– програма кінцевого користувача для читання та відправлення email
- **MTA (Mail Transfer Agent)**– отримує пошту і/або передає її далі до інших серверів
- **MDA (Mail Delivery Agent)**– доставляє пошту до локального користувача

# Формат Повідомлення

- Формат адреси: *user@domain*
- Повідомлення (RFC 5321): конверт, **заголовок**, 
тіло
- Можна визначати власні поля заголовку: назви починаються префіксом X-.

- Заголовок відділяється від тіла порожнім рядком - Заголовок складається з полів: <Ім'я>:<Вміст>

# Основні Поля Заголовку, Згідно Rfc 5322

| Поле         | Значення                                         |
|--------------|--------------------------------------------------|
| To:          | Адреса основного отримувача (отримувачів)        |
| Cc:          | Адреса додаткового отримувача (отримувачів)      |
| Bcc:         | Адреса прихованої копії                          |
| From:        | Автор повідомлення                               |
| Sender:      | Відправник повідомлення                          |
| Received:    | Рядок, що додається кожним MTA протягом маршруту |
| Return-Path: | Ідентифікація зворотного шляху до відправника    |

# Деякі Додаткові Поля Заголовку, Згідно Rfc 5322

| Поле         | Значення                                                                                  |
|--------------|-------------------------------------------------------------------------------------------|
| Date:        | Дата і час відправлення повідомлення                                                      |
| Reply-To:    | Адреса для відповіді                                                                      |
| Message-Id:  | Унікальний ідентифікатор повідомлення Ідентифікатор (Message-Id) повідомлення, відповіддю |
| In-Reply-To: | на яке є це повідомлення                                                                  |
| References:  | Інші повідомлення (Message-Id), пов'язані з цим                                           |
| Keywords:    | Ключові слова, визначені користувачем                                                     |
| Subject:     | Тема повідомлення одним рядком                                                            |

MIME - універсальне розширення електронної пошти
- Початкова пошта - ASCII текст
- **MIME** (Multipurpose Internet Mail Extension) –
правила кодування для передачі не-ASCII
повідомлень
- Використання - електронна пошта, веб
- RFC 2045–2047, 4288, 4289 i 2049

# Формат Повідомлення

MIME-version: 1.0 Content-type: multipart/mixed; boundary="frontier" This is a multi-part message in MIME format.

-frontier Content-type: text/plain
-frontier Content-type: application/octet-stream Content-transfer-encoding: base64 Pgh0bWw+CiAgPGhlYWQ+CiAgPC9oZWF
kPgogIDxib2R5PgogICAgPHA+VGhpcyBpc yB0aGugYm9keSBvZiB0aGUgbWVzc2FnZ
S48L3A+CiAgPC9ib2R5Pgo8L2h0bWw+Cg
-frontier--

# Поля Заголовка Mime

| Поле                      | Опис                                                       |
|---------------------------|------------------------------------------------------------|
| MIME-Version:             | Ідентифікатор версії MIME                                  |
| Content-Description:      | Опис вмісту (неформальний) Унікальний ідентифікатор вмісту |
| Content-Id:               | повідомлення                                               |
| Content-TransferEncoding: | Спосіб кодування тіла повідомлення                         |
| Content-Type:             | Тип і формат вмісту повідомлення                           |

# Content-Transfer-Encoding

- **7bit** - 7 біт, рядок не більше 1000 символів - **8bit** - 8 біт, рядок не більше 1000 символів
- **Binary** - 8-біт, без обмежень рядка і ознаки CRLF
- **Base64** - групи по 24 біти розбиваються на 4 символи по 6 бітів, кожен з яких відправляється дозволеним ASCII символом
- **quoted-printable** - 7-бітовий ASCII, символи ASCII-коду більше 127 кодуються як =HEX (HEX - шістнадцятковий код символу)
- **x-token** - власне кодування

# Типи І Деякі Підтипів Mime

| Тип         | Підтип                                   | Опис                        |
|-------------|------------------------------------------|-----------------------------|
| text        | plain, html, xml, css, csv, php          | Текст в різних форматах     |
| image       | gif, jpeg, tiff, png                     | Зображення                  |
| audio       | basic, mpeg, mp4                         | Звук                        |
| video       | mpeg, mp4, quicktime                     | Відео                       |
| model       | vrml                                     | 3D-модель                   |
| application | octet-stream, pdf, javascript, zip, json | Двійкові дані додатків      |
| message     | http,rfc822                              | Інкапсульоване повідомлення |
| multipart   | mixed, alternative, paralell, digest     | Комбінація кількох типів    |

# Передача Повідомлень

- **SMTP** - Simple Mail Transfer Protocol (RFC 2821)
- Транспорт: ТСР, серверний порт: 25
- Протокол передачі повідомлень до сервера електронної пошти за допомогою простих текстових команд

# Передача Електронної Пошти

![32_image_0.png](32_image_0.png)

Ana@maildomain-abc.com Lav@maildomain-xyz.com

# Діалог Smtp

![33_image_0.png](33_image_0.png)

# Команди Smtp Та Esmtp

- SMTP

| Команда   | Опис                                  |
|-----------|---------------------------------------|
| DATA      | Пересилання вмісту листа              |
| HELO      | Встановлення з'єднання SMTP           |
| HELP      | Перелік доступних команд              |
| MAIL      | Відправник листа                      |
| NOOP      | Підтримування з'єднання               |
| QUIT      | Завершення сеансу SMTP                |
| RCPT      | Отримувач листа                       |
| RSET      | Переривання сеансу SMTP               |
| VRFY      | Перевірка існування поштової скриньки |

- ESMTP

| Команда    | Опис                                                |
|------------|-----------------------------------------------------|
| AUTH       | Автентифікація                                      |
| DSN        | Повідомлення про стан доставки                      |
| EHLO       | Перелік реалізованих команд ESMTP                   |
| ETRN       | Пересилання черги листів для підключеного сервера   |
| PIPELINING | Потокове пересилання листа                          |
| SIZE       | Вказання розміру листа, що пересилається            |
| 8BITMIME   | Підтримка 8-бітового кодування листа                |
| RESTART    | Відновлення пересилання листа при розірванні сеансу |

# Коди Відповіді Smtp

| 1xy   | Попередній позитивний відгук   | Команда прийнята, але сервер очікує підтвердження на  продовження або відмову від виконання запитаних дій (ESMTP)   |
|-------|--------------------------------|---------------------------------------------------------------------------------------------------------------------|
| 2xy   | Позитивний відгук              | Дія виконана, сервер готовий до прийняття нової команди                                                             |
| 3xy   | Позитивний проміжний відгук    | Команда прийнята, але для завершення дії очікує подальшої  інформації                                               |
| 4xy   | Тимчасовий негативний відгук   | Команда не прийнята, дія може бути запитана ще раз                                                                  |
| 5xy   | Негативний відгук              | Команда не прийнята, дії не виконані                                                                                |

| Код   | Опис                                            |
|-------|-------------------------------------------------|
| 220   | Служба готова до роботи                         |
| 250   | Виконання команди успішно завершено             |
| 354   | Початок прийому повідомлення                    |
| 450   | Поштова скринька недоступна (тимчасово зайнята) |
| 452   | Поштова скринька переповнена                    |
| 500   | Синтаксична помилка, команда не розпізнана      |
| 501   | Синтаксична помилка в команді або аргументі     |
| 552   | Перевищено виділене на сервері місце            |

SMTP
передача пошти між MUA, MTA і MDA

![36_image_0.png](36_image_0.png)

Протоколи доставки пошти

# Протокол Imap

- Один з головних протоколів - **IMAP** (Internet Message Access Protocol), удосконалена версія протоколу **РОР3**
- Четверта версія описана в RFC 3501
- Транспортний протокол: TCP, порт: 143

# Команди Imap

| Команда      | Опис                                           |
|--------------|------------------------------------------------|
| CAPABILITY   | Перелік можливостей сервера                    |
| STARTTLS     | Запустити безпечний транспорт TLS              |
| LOGIN        | Вхід на сервер через ім'я користувача і пароль |
| AUTHENTICATE | Авторизація іншим способом                     |
| SELECT       | Вибір папки                                    |
| EXAMINE      | Вибір папки тільки для читання                 |
| CREATE       | Створення папки                                |
| DELETE       | Видалення папки                                |
| RENAME       | Перейменування папки                           |
| SUBSCRIBE    | Додавання папки до активного набору            |
| UNSUBSCRIBE  | Видалення папки до активного набору            |
| LIST         | Перелік доступних папок                        |
| LSUB         | Перелік активних папок                         |

# Команди Imap (2)

| Команда   | Опис                                             |
|-----------|--------------------------------------------------|
| STATUS    | Отримати статус папки                            |
| APPEND    | Додати повідомлення в папку                      |
| CHECK     | Переглянути стан вибраної папки                  |
| FETCH     | Переглянути повідомлення в папці                 |
| SEARCH    | Пошук повідомлень в папці                        |
| STORE     | Зміна мітки повідомлення                         |
| COPY      | Зробити копію повідомлення в папці               |
| EXPUNGE   | Видалити помічені повідомлення                   |
| UID       | Виконати команди з використанням ідентифікаторів |
| NOOP      | Немає операції                                   |
| CLOSE     | Видалити помічені повідомлення і закрити папку   |
| LOGOUT    | Вийти з системи і закрити з'єднання              |

# Протокол Pop3

- **POP3** (Post Office Protocol Version 3), RFC 1939.

- Транспортний протокол: ТСР, порт: 110
- Менше можливостей, менш безпечний
- Зазвичай пошта завантажується на комп'ютер з MUA, а не залишається на поштовому сервері
- Все ще широко використовується

# Команди Рор3

| Команда                | Аргументи                                      | Опис                                        | Можливі відповіді                                                                |
|------------------------|------------------------------------------------|---------------------------------------------|----------------------------------------------------------------------------------|
| APOP                   | [ім'я] [digest]                                | Передача серверу імені користувача          | +OK maildrop has n message                                                       |
| і зашифрованого пароля | -ERR password supplied for [ім'я] is incorrect |                                             |                                                                                  |
| USER                   | [ім'я]                                         | Передача серверу імені користувача          | +OK name is a valid mailbox -ERR never heard of mailbox name                     |
| PASS                   | [пароль]                                       | Передача серверу пароля                     | +OK maildrop locked and ready -ERR invalid password -ERR unable to lock maildrop |
| DELE                   | [повідомлення]                                 | Помітити вказане повідомлення для           | +OK message deleted -ERR no such message                                         |
| LIST                   | [повідомлення]                                 | Інформація про вказане (або всі)  видалення | +OK scan listing follows -ERR no such message                                    |
| NOOP                   | -                                              | Нічого не робити                            | +OK                                                                              |
| повідомлення           |                                                |                                             |                                                                                  |

# Команди Рор3 (2)

| Команда                                   | Аргументи                                | Опис                                    | Можливі відповіді                        |
|-------------------------------------------|------------------------------------------|-----------------------------------------|------------------------------------------|
| RETR                                      | [повідомлення]                           | Сервер передає повідомлення із вказаним | +OK message follows -ERR no such message |
| RSET                                      | -                                        | Відміна транзакцій в межах сеансу       | +OK                                      |
| номером                                   |                                          |                                         |                                          |
| STAT                                      | -                                        | Сервер повертає кількість повідомлень в | +OK a b                                  |
| скриньці та її розмір в октетах           |                                          |                                         |                                          |
| TOP                                       | [повідомлення]                           | Сервер повертає заголовки вказаного     | +OK n octets                             |
| [кількість рядків]                        | повідомлення, порожній рядок і зазначену | -ERR no such message                    |                                          |
| кількість перших рядків тіла повідомлення |                                          |                                         |                                          |
| QUIT                                      | -                                        | Завершення сеансу                       | +OK                                      |

# Діалог Рорз

## Pop3 Client Pop3 Server

![44_image_0.png](44_image_0.png)

# Електронна Пошта: Підсумок

![45_image_0.png](45_image_0.png)

